$(document).ready(function() {
  // alert('load');

  // Created step on page load
  var state_help = { foo: 'step1' };
  history.pushState(state_help, 'Help page 1', '');
  console.log('Added-step1');

  // Modal ('#privacy_policy, #terms_of_use, #join_network, #zip_help')
  $('.modal-link').click(function() {
    // alert('modal-link');
    var dataTarget = $(this).attr('data-target');
    $(dataTarget).addClass('modal-slide-up');
    $(dataTarget).parent().addClass('mw-visible');
    $('body').addClass('open-modal');

    var state_help = { foo: 'step2' };
    history.pushState(state_help, 'Help page 2', '');
    console.log('Added-step2');
    return false;
  });
  $('.modal-close').click(function() {
    $(this).parent().removeClass('modal-slide-up');
    $(this).closest('.modal-warp').removeClass('mw-visible');
    $('body').removeClass('open-modal');
  });
  // End

  // Help steps
  $('.hs-link').click(function() {
    // alert('hs-link');
    $('#overlay > section').removeClass('modal-slide-up');
    $('#slides > section').removeClass('hs-slide-left');
    var dataHelp = $(this).attr('data-help');
    $(dataHelp).addClass('hs-slide-left');
    $(dataHelp).parent().addClass('hs-visible');
    $('body').addClass('open-hs');

    for(i = 3; i < 15; i++) {
      // alert(i);
      var state_help = { foo: 'step' + i };
      history.pushState(state_help, 'Help page ' + i, '');
      console.log('Added-step' + i);
      return false;
    }
  });
  // End

  // Last step
  $('.when-last-step ul li .when-link').click(function() {
    $('#slides > section').removeClass('hs-slide-left');
    $('#search').show();
    $('#intro').hide();
    $('#cards').hide();
  });
  // End

});

window.onpopstate = function(event) {
  var state = 0;
  var state = event.state;
  if (state !== null) {
    switch(state.foo) {
      case "step1":
        console.log('Removed-step2');
        // Close 'modal-link' Modal
        $('#overlay > section').removeClass('modal-slide-up');
        $('#overlay > section').closest('.modal-warp').removeClass('mw-visible');
        $('body').removeClass('open-modal');
        // End
      break;

      case "step2":
        console.log('Removed-step3');
        
      break;

      case "step3":
        console.log('Removed-step4');
        
      break;

      case "step4":
        console.log('Removed-step5');
        
      break;

      case "step5":
        console.log('Removed-step6');
        
      break;
    }
  }
};

// Enter Your 2-Digit Number End
function loader() {
  var e = document.getElementById('progressBar');
  var f = new ProgressBar.Circle(e, {
      strokeWidth: 6,
      easing: 'linear',
      duration: 15000,
      color: '#888888',
      trailColor: '#e9e9e9',
      trailWidth: 6,
      svgStyle: null,
      text: {
        autoStyleContainer: true
      },
      from: {
        color: '#45d1a6',
        width: 6
      },
      to: {
        color: '#45d1a6',
        width: 6
      },
      step: function(a, b) {
        b.path.setAttribute('stroke', a.color);
        b.path.setAttribute('stroke-width', a.width);
        var c = Math.round(b.value() * 100);
        if (c === 0) {
            b.setText('')
        } else {
            b.setText(c + '%')
        }
        var d = setInterval(function() {
          if (c > 0 && c < 24) {
            f.animate(0.25, {
                duration: 200
            }, function() {});
            clearInterval(d)
          }
          if (c > 24 && c < 49) {
            f.animate(0.50, {
                duration: 500
            }, function() {});
            clearInterval(d)
          }
          if (c > 49 && c < 96) {
            f.animate(0.97, {
                duration: 1000
            }, function() {});
            clearInterval(d)
          }
          if (c > 96 && c < 100) {
            f.animate(1, {
                duration: 500
            }, function() {});
            clearInterval(d)
          }
        }, 1000);
        if (c > 0 && c < 26) {
          $('.progressText').text('Calculating...').fadeIn("slow")
        }
        if (c > 26 && c < 50) {
          var c = $('#enter_zip').val();
          $('.progressText').text('Searching for painters in' + ' ' + c + '...').fadeIn("slow")
        }
        if (c > 50 && c < 98) {
          $('.progressText').text('Finding painters...').fadeIn("slow")
        }
        if (c > 98 && c < 100) {
          $('.progressText').text('Painters Found!').fadeIn("slow")
        }
        setTimeout(function() {
          if (c === 100) {
            $('.progressText').text('Painters Found!').fadeIn("slow");
            $('.progressbar-text').html('<img src="images/success-loader.svg" width="50"/>')
          }
        }, 2000);
        setTimeout(function() {
          if (c === 100) {
            slide7.hide();
            slide8.show()
          }
        }, 4000);
        return false
      }
  });
  f.text.style.fontFamily = '"CircularStd-Bold';
  f.text.style.fontSize = '24px';
  f.animate(1.0);
  return false
}
